#!/usr/bin/env bash

{{/* Include external functions */}}
{{ template "install-brewfile.tmpl" . }}
{{ template "install-nodejs.tmpl" . }}
{{ template "install-python.tmpl" . }}
{{ template "install-rust.tmpl" . }}
{{ template "vscode-extensions.tmpl" . }}

#################### Main Program ####################

# Stop script on error
set -eo pipefail

{{ if not .env.ephemeral -}}

# Setup environment
test -d ~/.linuxbrew && eval "$(~/.linuxbrew/bin/brew shellenv)"
test -d /home/linuxbrew/.linuxbrew && eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"

# Install dependencies
install_brewfile

# Install / update Node.js
install_nodejs

# Install / update Python
install_python

# Install Rust
install_rust

{{- end }}

{{ if not (or .env.wsl .env.ephemeral) -}}

# Install VSCode extensions
install_extensions

{{- end }}
