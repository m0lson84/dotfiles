{{- /* Packages to install */ -}}
{{- $apps := (concat .packages.common.apps .packages.arch.apps) | sortAlpha | uniq -}}
{{- $tools := (concat .packages.common.tools .packages.arch.tools) | sortAlpha | uniq -}}


#!/usr/bin/env bash
# ---------------------------------------------------------------------------
# Install applications and tools
# ---------------------------------------------------------------------------

{{/* Include external functions */}}
{{ template "install-rust.tmpl" . }}


#######################################
# Install packages
#######################################
function install_packages() {
  local pm={{ template "arch-pm.tmpl" . }}
  $pm -Syu --noconfirm
  $pm -S --needed --noconfirm {{ (concat $apps $tools) | join " " }}
}


#################### Main Program ####################

# Stop script on error
set -eo pipefail

{{ if not .env.ephemeral -}}

# Install packages
install_packages

# Install Rust
install_rust

{{- end }}

